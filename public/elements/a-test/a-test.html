<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../components/polymer/polymer.html">
<link rel="import" href="../../components/iron-flex-layout/iron-flex-layout.html">
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:400,300,600,700,800">
<link rel="import" href="../../components/paper-input/paper-input.html">
<link rel="import" href="../../components/paper-item/paper-item.html">

<link rel="import" href="../a-streets/a-streets.html">

<link rel="import" href="../../components/paper-button/paper-button.html">
<link rel="import" href="../../components/iron-selector/iron-selector.html">

<link rel="import" href="../../components/iron-ajax/iron-ajax.html">

<script src="../../components/lodash/lodash.js"></script>
<script src="../../components/momentjs/moment.js"></script>

<dom-module id="a-test">
  <style>
    :host {
      display: block;
      width: 100%;
      background-color: #D9F299;
      margin: 0px;
      padding: 20px 0px 50px 50px;
      font-family: 'Open Sans', sans-serif;

      @apply(--layout-vertical);
      @apply(--layout-start);
    }

    h3 {
      margin: 30px 0px 10px 0px;
      padding: 0px;
      font-weight: 300;
      font-size: 22px;
    }


    h4 {
      margin: 0px;
      padding: 0px;
      font-weight: 300;
      font-size: 16px;

    }




    paper-button {
      border-radius: 0px;
      outline: 0;
      border-style:solid;
      -webkit-appearance: none;
    }


    paper-input-container{
      --paper-input-container-color: #A1B56E;
      --paper-input-container-focus-color:black;

    }




    #regloc {
      margin-top: 20px;
      width: 60%;
    }

    #geoloc {
      margin-top: 20px;
      width: 100%;
    }


    .btnz {
      margin: 0px;
      padding: 0px;
      border: none;
      background-color: 
    }

    .streetz {
      border-bottom: 1px solid #A1B56E;
      margin: 0px;
      padding: 10px 0px 10px 0px; 
      width: 60%;
      background-color: white;
    }

  </style>
  <template>

    <iron-ajax
    handle-as="json"
    on-response="handleResponse"
    debounce-duration="300"
    id="ophaalkal"></iron-ajax>

<!-- 
  <div id="geoloc">
    <button>Gebruik mijn huidige locatie!</button>
  </div> -->
  <div id="regloc">
    <h3>Geef een adres op</h3>

<paper-input-container>
  <label>Postcode</label>
  <input is="iron-input" maxlength="4" prevent-invalid-input allowed-pattern="[0-9]"  bind-value="{{postal}}">
  <paper-input-char-counter></paper-input-char-counter>
</paper-input-container>

<template is="dom-if" if="{{postal}}">
<paper-input-container>
  <label>Straat</label>
  <input is="iron-input" bind-value="{{street}}">
</paper-input-container>
    </template>
  </div>

<a-streets postal={{postal}} street={{street}} streets={{kaki}}></a-streets>

<template is="dom-if" if="{{street}}">
  <iron-selector attr-for-selected="name" selected={{straatselect}}>

  <template is="dom-repeat" items="{{kaki}}">
      <div name="{{item.Id}}">{{item.Value}}</div>
  </template>
</iron-selector>

</template>

<span>{{Ophaal}}</span>

<template is="dom-if" if={{Ophaal}}>
  <template is="dom-repeat" items={{Ophaal}}>
    <p>{{item.fractie}}</p>
    <p>{{item.start}}</p>
    <p>{{item.kleur}}</p>
  </template>
</template>

</template>
</dom-module>
<script>
(function() {

  Polymer({
    is: 'a-test',

    properties: {
      foo: {
        type: String,
        value: 'bar',
        notify: true
      },
      straatselect: {
        type: String,
        value: 'bar',
        notify: true,
        observer: 'selectHandler'
      }
    },

    ready: function(){
            

    },

    selectHandler: function(){
      console.log(this.straatselect);
      this.$.ophaalkal.url = '/rides?streetId='+this.straatselect;
      this.$.ophaalkal.generateRequest();
    },



    handleResponse: function(e){
      //console.log(e.detail.response);
      var Things = e.detail.response;
      Things.reverse();

      ophaal = [];
      //this.Things = Things;
      //var thing = Things[0];
      //var hallo = _.filter(Things, function(thing){
        //console.log(thing.start);
        var today = new moment();
        var future = new moment().add(7, 'd');

        for (var i = Things.length - 1; i >= 0; i--) {
          var startdate = new Date(Things[i].start);
          if(startdate>today&&startdate<future){
            console.log(Things[i].start);
            ophaal.push({"id": i, "start": Things[i].start, "fractie": Things[i].title, "kleur": Things[i].color });
          };
        }; 

        console.log(JSON.stringify(ophaal));

        this.Ophaal = ophaal;

        
        //var tom = moment(startdate).startOf('week');
        
        //onsole.log(tom, ' // ', startdate, ' // ');
        
      //});
      //console.log(Things);
      

    }
  });
})();
</script>
